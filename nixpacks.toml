[phases.setup]
nixPkgs = ['nodejs_20', 'curl']

[phases.install]
cmds = [
  # Create data directory
  'mkdir -p map-app/public/data',
  
  # Download tickets_aggregated.geojson from GitHub Releases
  'curl -fL "https://github.com/monuit/toronto-parking/releases/download/v1.0-data/tickets_aggregated.geojson" -o map-app/public/data/tickets_aggregated.geojson',
  
  # Verify file was downloaded and matches expected size (should be ~240MB)
  'test -s map-app/public/data/tickets_aggregated.geojson || (echo "Failed to download tickets_aggregated.geojson from GitHub Releases" && exit 1)',
  
  'cd map-app && npm ci'
]

[phases.build]
cmds = ['cd map-app && npm run build:ssr']

[start]
cmd = 'cd map-app && npm start'
