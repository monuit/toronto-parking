{
  "$schema": "https://schema.railpack.com",
  "provider": "node",
  "packages": {
    "node": "22",
    "python": "3.13"
  },
  "steps": {
    "install": {
      "commands": [
        "...",
        {
          "src": "requirements.txt",
          "dest": "requirements.txt"
        },
        "python -m venv /app/.venv",
        ". /app/.venv/bin/activate && pip install -r requirements.txt"
      ]
    },
    "build": {
      "commands": [
        "cd /app/map-app && npm install @rollup/rollup-linux-x64-gnu --save-optional",
        "cd /app/map-app && npm run build:ssr"
      ]
    }
  },
  "deploy": {
    "startCommand": "cd /app/map-app && node scripts/run-with-heap.mjs server/index.js",
    "variables": {
      "NODE_ENV": "production",
      "MAP_APP_MAX_HEAP_MB": "4096",
      "NODE_OPTIONS": "--expose-gc",
      "UV_THREADPOOL_SIZE": "2",
      "TILE_WARMUP_ENABLED": "0",
      "POSTGIS_TILE_POOL_SIZE": "2",
      "POSTGIS_TILE_POOL_IDLE_MS": "30000",
      "POSTGIS_TILE_MEMORY_CACHE_LIMIT": "32",
      "GLOW_GEOJSON_CACHE_TTL_MINUTES": "10",
      "GLOW_TILE_CACHE_TTL": "86400",
      "CAMERA_LOCATIONS_CACHE_SECONDS": "3600",
      "CAMERA_WARD_CACHE_SECONDS": "3600",
      "APP_DATA_REFRESH_SECONDS": "1800",
      "MEMORY_WARNING_THRESHOLD": "0.70",
      "MEMORY_CRITICAL_THRESHOLD": "0.80",
      "MEMORY_EMERGENCY_THRESHOLD": "0.85",
      "RESET_CACHE_ON_BOOT": "0"
    }
  }
}